function Template(){}Template.MODAL_ZINDEX=100;Template.prototype.KILO=1024;Template.prototype.MEGA=1048576;Template.prototype.GIGA=1073741824;
Template.prototype.LISTS={dateRanges:[{id:"today",name:"Today"},{id:"yesterday",name:"Yesterday"},{id:"thisWeek",name:"This Week"},{id:"lastWeek",name:"Last Week"},{id:"thisMonth",name:"This Month"},{id:"lastMonth",name:"Last Month"},{id:"thisQuarter",name:"This Quarter"},{id:"lastQuarter",name:"Last Quarter"},{id:"thisYear",name:"This Year"},{id:"lastYear",name:"Last Year"},{id:"custom",name:"Custom"}],logLevels:[{id:"ALL",name:"All"},{id:"DEBUG",name:"Debug"},{id:"ERROR",name:"Error"},{id:"INFO",
name:"Info"},{id:"OFF",name:"Off"},{id:"TRACE",name:"Trace"},{id:"WARN",name:"Warn"}],radiusUnits:[{id:"km",name:"Kilometers"},{id:"mi",name:"Miles"}],yesNoOptions:[{id:"true",name:"Yes"},{id:"false",name:"No"}],pageSizes:[{id:10,name:"10"},{id:20,name:"20"},{id:50,name:"50"},{id:100,name:"100"},{id:1E3,name:"1000"}]};Template.prototype.REGEX_UTC=/\+0000/;Template.prototype.REGEX_GMT_TIME=/ 00:00:00 GMT/;Template.prototype.REGEX_NEW_LINE=/[\n]+/;Template.prototype.REGEX_PATH_PREFIX=/\/$/;
Template.prototype.REGEX_WHITESPACE=/[\s]+/g;Template.prototype.CSS_ACTIONS="actions";Template.prototype.CSS_FIELDS="fields";Template.prototype.CSS_MODAL="modal";Template.prototype.CAPTION_ADD="Add";Template.prototype.CAPTION_BACK="Back";Template.prototype.CAPTION_CANCEL="Cancel";Template.prototype.CAPTION_CLOSE="Close";Template.prototype.CAPTION_COPY="Copy";Template.prototype.CAPTION_IMPORT="Import";Template.prototype.CAPTION_PREVIEW="Preview";Template.prototype.CAPTION_REMOVE="Remove";
Template.prototype.CAPTION_SUBMIT="Submit";Template.prototype.HEADER_SESSION=Template.HEADER_SESSION="X-AllClear-SessionID";Template.prototype.SESSION_DURATION_LONG=2592E6;Template.prototype.SESSION_DURATION_SHORT=18E5;
Template.prototype.PUBLIC_GET_RESOURCES=Template.PUBLIC_GET_RESOURCES={sessions:!0,agentFamilies:!0,agentTypes:!0,applicationStatuses:!0,deviceTypes:!0,documentRepos:!0,documentSources:!0,jobStatuses:!0,labels:!0,linkTypes:!0,loginTypes:!0,osFamilies:!0,phoneTypes:!0,roles:!0,sourceMappingTypes:!0,sourceTypes:!0,timeZones:!0,tlds:!0,userTypes:!0};Template.prototype.load=function(a){if(void 0!=a)for(id in a)this[id]=a[id]};
Template.prototype.run=function(a,b,c){var d=this;b&&(a.body=b);void 0==c&&(c="post");void 0==a.isModal&&(a.isModal=void 0==a.body);if(a.isModal&&void 0==a.body){var e=document.body;e.insertBefore(b=this.createDiv("Loading ...","modalDialog"),e.firstChild);b=a.body=$(b);b.CENTERED=0;b.center=function(){var a=$(window);this.css("top",(this.top=(a.height()-this.height())/2+a.scrollTop())+"px");this.css("left",(this.left=(a.width()-this.width())/2+a.scrollLeft())+"px");b.css("zIndex",Template.MODAL_ZINDEX++);
this.CENTERED++};b.closeMe=function(){Template.MODAL_ZINDEX-=this.CENTERED;this.remove()}}ProgressBar.start(a);if(void 0!=a.url)this[c](a.url,a.filter,function(b){ProgressBar.stop(a);d.display(a,b)});else ProgressBar.stop(a),d.display(a,a.value);return a};
Template.prototype.display=function(a,b){a.body.empty();a.value=b;var c=this,d=a.isModal;if(d){var e=a.header=this.createHeader();this.addSpan(e,this.getTitle(a));a.body.append($(e));e.appendChild(this.createAnchor("X",function(b){c.handleCancel(a)}));this.makeElementDraggable(a,e)}a.body.append($(this.generate(a)));if(this.onPostLoad)this.onPostLoad(a);d&&a.body.center()};Template.prototype.getRestPath=Template.getRestPath=function(){return REST_PATH};
Template.prototype.get=Template.get=function(a,b,c,d,e){var f=this;e||(e=this.getRestPath());$.ajax(e+a,{type:"GET",data:b,cache:!1,dataType:"json",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(e){f.handleError(e,c,"get",a,b,d)}})};
Template.prototype.auth=Template.auth=function(a,b,c,d){var e=this;$.ajax(this.getRestPath()+a,{type:"GET",data:b,cache:!1,dataType:"json",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){403==f.status?c(null):e.handleError(f,c,"get",a,b,d)}})};
Template.prototype.html=Template.html=function(a,b,c,d){d||(d={});d.Accept="text/html";var e=this;$.ajax(this.getRestPath()+a,{type:"GET",data:b,cache:!1,dataType:"text",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){e.handleError(f,c,"html",a,b,d)}})};
Template.prototype.text=Template.text=function(a,b,c,d){var e=this;$.ajax(this.getRestPath()+a,{type:"GET",data:b,cache:!1,dataType:"text",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){e.handleError(f,c,"text",a,b,d)}})};
Template.prototype.post=Template.post=function(a,b,c,d){var e=b?JSON.stringify(b):null,f=this;$.ajax(this.getRestPath()+a,{type:"POST",data:e,dataType:"json",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(e){f.handleError(e,c,"post",a,b,d)},contentType:"application/json; charset=UTF-8"})};
Template.prototype.xml=Template.xml=function(a,b,c,d){b||(b={});var e=this;$.ajax(this.getRestPath()+a,{type:"POST",data:b.payload,dataType:"json",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){e.handleError(f,c,"xml",a,b,d)},contentType:"text/plain; charset=UTF-8"})};
Template.prototype.xmlPut=Template.xmlPut=function(a,b,c,d){b||(b={});var e=this;$.ajax(this.getRestPath()+a,{type:"PUT",data:b.payload,dataType:"json",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){e.handleError(f,c,"xml",a,b,d)},contentType:"text/plain; charset=UTF-8"})};
Template.prototype.dump=Template.dump=function(a,b,c,d){b||(b={});var e=this;$.ajax(this.getRestPath()+a,{type:"POST",data:JSON.stringify(b),dataType:"text",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){e.handleError(f,c,"dump",a,b,d)},contentType:"application/json; charset=UTF-8"})};
Template.prototype.put=Template.put=function(a,b,c,d){b||(b={});var e=this;$.ajax(this.getRestPath()+a,{type:"PUT",data:JSON.stringify(b),dataType:"json",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){e.handleError(f,c,"put",a,b,d)},contentType:"application/json; charset=UTF-8"})};
Template.prototype.remove=Template.remove=function(a,b,c,d){var e=this;$.ajax(this.getRestPath()+a+(void 0!=b?"/"+b:""),{type:"DELETE",dataType:"json",headers:this.appendCurrentSessionId(d),success:function(a){c(a)},error:function(f){e.handleError(f,c,"remove",a,b,d)}})};
Template.prototype.multiPart=Template.multiPart=function(a,b,c,d){b||(b=new FormData);var e=this;$.ajax(this.getRestPath()+a,{type:"POST",data:b,cache:!1,dataType:"json",processData:!1,contentType:!1,headers:this.appendCurrentSessionId(d),success:c,error:function(f){e.handleError(f,c,"multiPart",a,b,d)}})};
Template.prototype.handleError=Template.handleError=function(a,b,c,d,e,f){if(200==a.status)b({});else if(403==a.status){var g=this;LoginHandler.doLogin(function(){g[c](d,e,b,f)})}else if(401==a.status)b({isError:!0,message:"The specified user is not authorized to perform this action."});else{var h=a.responseText;h?(h=JSON.parse(h),void 0==h.message&&void 0!=h.error&&(h.message=h.error)):h={message:a.statusText};h.isError=!0;delete h.stackTrace;b(h)}};Template.prototype.getList=function(a){return this.LISTS[a]};
Template.prototype.loadLists=function(a){for(var b=0;b<a.length;b++)this.loadList(a[b])};Template.prototype.loadList=function(a){var b=this;this.get("types/"+a,void 0,function(c){b.LISTS[a]=c})};Template.prototype.clean=function(a){var b;for(id in a)"string"==typeof(b=a[id])&&""==b&&delete a[id]};
Template.prototype.appendCurrentSessionId=Template.appendCurrentSessionId=function(a){var b=this.getCurrentSession();if(void 0==b)return a;void 0==a&&(a={});a[this.HEADER_SESSION]=b.id;this.setCurrentSessionId(b.id,b.userName,b.rememberMe);return a};Template.prototype.getCurrentSession=Template.getCurrentSession=function(){return Cookies.getJSON(this.HEADER_SESSION)};
Template.prototype.setCurrentSessionId=Template.setCurrentSessionId=function(a,b,c){if(void 0!=a){var d=c?this.SESSION_DURATION_LONG:this.SESSION_DURATION_SHORT,e=new Date;e.setTime(e.getTime()+d);Cookies.set(this.HEADER_SESSION,{id:a,userName:b,rememberMe:c},{expires:e})}};Template.prototype.deleteCurrentSessionId=Template.deleteCurrentSessionId=function(){Cookies.remove(this.HEADER_SESSION)};Template.prototype.createImg=function(a,b){var c=document.createElement("img");c.src=a;b&&(c.title=b);return c};
Template.prototype.createImage=function(a,b){var c=document.createElement("img");c.src=IMAGE_PATH+a;b&&(c.title=b);return c};Template.prototype.createAnchor=Template.createAnchor=function(a,b,c){var d=document.createElement("a");d.href="javascript:void(null)";d.onclick=b;b=typeof a;"string"==b||"number"==b?d.innerHTML=a:void 0!=a&&d.appendChild(a);c&&(d.className=c);return d};
Template.prototype.createLink=Template.createLink=function(a,b,c,d){var e=document.createElement("a");e.href=b;b=typeof a;"string"==b||"number"==b?e.innerHTML=a:e.appendChild(a);c&&(e.className=c);d&&(e.target=d);return e};Template.prototype.createDiv=function(a,b){return this.createElement("div",a,b)};Template.prototype.createHeader=function(a,b){return this.createElement("h1",a,b)};Template.prototype.createSpan=function(a,b){return this.createElement("span",a,b)};
Template.prototype.createElement=Template.createElement=function(a,b,c){a=document.createElement(a);b&&(a.innerHTML=b);c&&(a.className=c);return a};Template.prototype.addBreak=Template.addBreak=function(a){var b=document.createElement("br");a.appendChild(b);return b};Template.prototype.addSpace=function(a){var b=document.createTextNode(" ");a.appendChild(b);return b};Template.prototype.addText=Template.addText=function(a,b){var c=document.createTextNode(b);a.appendChild(c);return c};
Template.prototype.addErrorText=Template.addErrorText=function(a,b){return this.addElem(a,"i",b,"error")};Template.prototype.addSuccessText=Template.addSuccessText=function(a,b){return this.addElem(a,"i",b,"success")};Template.prototype.addElem=Template.addElem=function(a,b,c,d){b=this.createElement(b,c,d);a.appendChild(b);return b};Template.prototype.addDiv=Template.addDiv=function(a,b,c){return this.addElem(a,"div",b,c)};
Template.prototype.addSpan=function(a,b,c){return this.addElem(a,"span",b,c)};Template.prototype.addValue=function(a,b,c){return this.addElem(a,"em",b,c)};Template.prototype.addCaption=function(a,b,c){return this.addElem(a,"b",b,c)};Template.prototype.addFootnote=function(a,b,c){return this.addElem(a,"em",b,c)};Template.prototype.addHeader=function(a,b,c){return this.addElem(a,"h1",b,c)};
Template.prototype.makeElementDraggable=function(a,b){$(b).mousedown(a,function(a){1==a.which&&(a.preventDefault(),a.data.pageX=a.pageX,a.data.pageY=a.pageY,$(document.body).mousemove(a.data,function(a){var b=a.data,c=b.body;c.css("top",(b.bodyTop=c.top+(a.pageY-b.pageY))+"px");c.css("left",(b.bodyLeft=c.left+(a.pageX-b.pageX))+"px")}))});$(document.body).mouseup(a,function(a){$(document.body).unbind("mousemove");a=a.data;var b=a.body;b.top=a.bodyTop;b.left=a.bodyLeft})};
Template.prototype.setFieldsMaxHeight=function(a){var b=$(window),c=a.body;a=a.fields;var d=c.height()-a.offsetHeight+15,d=b.height()-d;b.height()<c.height()?(a.style.height=d+"px",a.style.width=a.offsetWidth+25+"px"):a.style.maxHeight=d+"px"};Template.prototype.toText=Template.toText=function(a){if(void 0==a)return"";var b=typeof a;return"boolean"==b?a?"Yes":"No":"number"==b?this.toNumber(a):a};Template.prototype.toIdentifier=function(a){return void 0==a?"":"boolean"==typeof a?a?"Yes":"No":a};
Template.prototype.toColumnText=function(a){return this.shrink(a,1E3)};Template.prototype.toColumnJSON=function(a){return this.shrink(this.toJSON(a),200)};Template.prototype.toName=function(a){return a?a.name:""};Template.prototype.toNames=function(a){return a?a.map(function(a){return a.name}).join(", "):""};Template.prototype.shrink=Template.shrink=function(a,b){return void 0==a?"":b>=a.length?a:a.substring(0,b)+"&hellip;"};
Template.prototype.fromArray=function(a){if(void 0==a||0==a.length)return"";for(var b=a[0],c=1;c<a.length;c++)b+="\n"+a[c];return b};Template.prototype.fromArrayWithComma=Template.fromArrayWithComma=function(a){if(void 0==a||0==a.length)return"";for(var b=a[0],c=1;c<a.length;c++)b+=", "+a[c];return b};Template.prototype.toArray=function(a){if(void 0==a||0==a.length)return[];a=a.split(this.REGEX_NEW_LINE);for(var b=0;b<a.length;b++)""==(a[b]=$.trim(a[b]))&&a.splice(b--,1);return a};
Template.prototype.parseCSV=function(a){if(void 0==a||0==a.length)return[];for(var b=a.length,c=[],d=0,e=0;d<b;d++){var f=a[d];","==f?(c[c.length]=d>e?a.substring(e,d):"",e=d+1):'"'==f&&(e=a.indexOf('"',d+1),-1==e?(c[c.length]=a.substring(d+1),d=b):(c[c.length]=a.substring(d+1,e),d=e+1),e=d+1)}d>e&&(c[c.length]=a.substring(e,d));return c};Template.prototype.round=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c};
Template.prototype.toCurrency=function(a){return void 0==a?"":this.toNumber(a,2)};Template.prototype.toPercent=function(a){return void 0==a?"":this.toNumber(this.round(100*a,2),2)};Template.prototype.fromMilliseconds=function(a){return void 0!=a?this.fromSeconds(a/1E3):""};Template.prototype.fromSeconds=function(a){if(void 0==a)return"";var b="",c=Math.floor(a/3600);0<c&&(b=c+" hours",a%=3600);c=Math.floor(a/60);0<c&&(b&&(b+=", "),b+=c+" minutes",a%=60);0<a&&(b&&(b+=", "),b+=a+" seconds");return b};
Template.prototype.toSeconds=function(a){return void 0==a?"":this.toNumber(this.round(a/1E3,3),3)};Template.prototype.toWhole=function(a){return void 0==a?"":this.toNumber(Math.round(a),0)};Template.prototype.toWholeN=Template.toWholeN=function(a){return void 0==a?"N/A":this.toNumber(Math.round(a),0)};
Template.prototype.toNumber=Template.toNumber=function(a,b){x=(a+"").split(".");x1=x[0];x2=1<x.length?x[1]:"";if(void 0!=b)if(x2.length<b)for(;x2.length<b;)x2+="0";else x2.length>b&&(x2=x2.substr(0,b));0<x2.length&&(x2="."+x2);for(var c=/(\d+)(\d{3})/;c.test(x1);)x1=x1.replace(c,"$1,$2");return x1+x2};Template.prototype.toBool=function(a){return"T"==a?"Yes":"No"};Template.prototype.today=Template.today=function(){var a=new Date;a.setUTCHours(0,0,0,0);return this.toDbDate(a)};
Template.prototype.weekAgo=Template.weekAgo=function(){var a=new Date;a.setUTCHours(0,0,0,0);a.setUTCDate(a.getUTCDate()-7);return this.toDbDate(a)};Template.prototype.toDateTime=function(a){return void 0==a?"":(new Date(a.replace(this.REGEX_UTC,"Z"))).toLocaleString()};Template.prototype.toDateTimeN=function(a){return void 0==a?"":(new Date(a)).toLocaleString()};Template.prototype.toDate=function(a){return void 0==a?"":(new Date(a.replace(this.REGEX_UTC,"Z"))).toDateString()};
Template.prototype.toDateUTC=function(a){return void 0==a?"":(new Date(a.replace(this.REGEX_UTC,"Z"))).toUTCString().replace(this.REGEX_GMT_TIME,"")};Template.prototype.toTime=function(a){return void 0==a?"":(new Date(a.replace(this.REGEX_UTC,"Z"))).toTimeString()};Template.prototype.toDbDate=Template.toDbDate=function(a){return a.getUTCFullYear()+"-"+this.padInt(a.getUTCMonth()+1)+"-"+this.padInt(a.getUTCDate())+"T00:00:00Z"};
Template.prototype.padInt=Template.padInt=function(a){return 10>a?"0"+a:a};Template.prototype.getTimezoneOffset=Template.getTimezoneOffset=function(){var a=(new Date).getTimezoneOffset();if(0==a)return"+0000";var b="-";0>a&&(a=-a,b="+");return b+this.padInt(parseInt(a/60))+this.padInt(a%60)};
Template.prototype.toDuration=function(a){if(void 0==a)return"";var b="";604800<a&&(b=this.appendUnit(b,this.round(a/604800,0),"week"),a%=604800);86400<a&&(b=this.appendUnit(b,this.round(a/86400,0),"day"),a%=86400);3600<a&&(b=this.appendUnit(b,this.round(a/3600,0),"hour"),a%=3600);60<a&&(b=this.appendUnit(b,this.round(a/60,0),"minute"),a%=60);return 0<a?this.appendUnit(b,a,"second"):b};
Template.prototype.toDurationN=function(a){return void 0==a?"":604800<a?this.appendUnit("",this.round(a/604800,2),"week"):86400<a?this.appendUnit("",this.round(a/86400,2),"day"):3600<a?this.appendUnit("",this.round(a/3600,2),"hour"):60<a?this.appendUnit("",this.round(a/60,2),"minute"):this.appendUnit("",a,"second")};Template.prototype.appendUnit=Template.appendUnit=function(a,b,c){0<a.length&&(a+=", ");return a+b+" "+c+(1<b?"s":"")};
Template.prototype.toSize=function(a){return a?this.KILO>a?this.toWhole(a)+" bytes":this.MEGA>a?this.toNumber(a/this.KILO,3)+" KB":this.GIGA>a?this.toNumber(a/this.MEGA,3)+" MB":this.toNumber(a/this.GIGA,3)+" GB":"N/A"};Template.prototype.trimToNull=Template.trimToNull=function(a){return void 0==a||""==(a=a.trim())?null:a};Template.prototype.toJSON=Template.toJSON=function(a){return void 0==a?"":JSON.stringify(a)};Template.prototype.fromJSON=Template.fromJSON=function(a){return""==a?void 0:JSON.parse(a)};
Template.prototype.cloneObject=Template.cloneObject=function(a){return null==a?null:JSON.parse(JSON.stringify(a))};Template.prototype.removeProperties=Template.removeProperties=function(a){if(void 0==a||"object"!=typeof a||1>=arguments.length)return a;for(var b=1;b<arguments.length;b++)a=this.removeProperty(a,arguments[b]);return a};
Template.prototype.removeProperty=Template.removeProperty=function(a,b){if(void 0==a||"object"!=typeof a)return a;for(id in a)id==b?delete a[id]:this.removeProperty(a[id],b);return a};
Template.prototype.genInput=Template.genInput=function(a,b,c){if(document.all)return document.createElement('<input name="'+a+'" type="'+b+'"'+(c?" checked":"")+" />");var d=document.createElement("input");d.name=a;d.type=b;d.checked=c;d.setFieldStatus=function(a){this.disabled=!a;this.previousSibling.className=a?"":"disabled"};return d};Template.prototype.genButton=Template.genButton=function(a,b,c){a=this.genInput(a,"button");b&&(a.value=b);c&&(a.onclick=c);return a};
Template.prototype.genCheckBox=Template.genCheckBox=function(a,b){return this.genInput(a,"checkbox",b)};Template.prototype.genCheckBoxes=function(a,b,c,d){d||(d=1);for(var e,f,g,h=this.createDiv(void 0,"multiselect"),k="column_"+d,l=0;l<b.length;l++){e=b[l];f=!1;if(c)for(var n=0;n<c.length&&!(f=e.id==c[n]);n++);0<l&&0==l%d&&this.addBreak(h);(g=this.addSpan(h,e.name,k)).insertBefore(f=this.genCheckBox(a,f),g.firstChild);f.value=e.id}return h};
Template.prototype.genFile=function(a,b,c){a=this.genInput(a,"file");b&&(a.maxLength=b);c&&(a.size=c);return a};Template.prototype.genHidden=Template.genHidden=function(a,b){var c=this.genInput(a,"hidden");void 0!=b&&(c.value=b);return c};
Template.prototype.genList=Template.genList=function(a,b,c,d){var e=document.createElement("select");e.name=a;e.multiple=!0;e.size=void 0!=b?b:10;if(c)for(a=e.options,b=0;b<c.length;b++){var f=c[b];a[a.length]=new Option(f.name,f.id)}d&&(e.value=d);e.setFieldStatus=function(a){this.disabled=!a;this.previousSibling.className=a?"":"disabled"};return e};Template.prototype.genPassword=function(a,b,c){a=this.genInput(a,"password");b&&(a.maxLength=b);c&&(a.size=c);return a};
Template.prototype.genRadio=function(a,b,c){a=this.genInput(a,"radio",b);c&&(a.value=c);return a};Template.prototype.genRadios=function(a,b,c,d){d||(d=1);for(var e,f,g,h=this.createDiv(void 0,"multiselect"),k="column_"+d,l=0;l<b.length;l++)e=b[l],0<l&&0==l%d&&this.addBreak(h),(g=this.addSpan(h,e.name,k)).insertBefore(f=this.genRadio(a,c[e.id]),g.firstChild),f.value=e.id;return h};
Template.prototype.genSelect=Template.genSelect=function(a,b,c,d){var e;document.all?e=document.createElement('<select name="'+a+'" />'):(e=document.createElement("select"),e.name=a);a=e.options;d&&(a[0]=new Option(d,""));if(b)for(d=0;d<b.length;d++){var f=b[d];a[a.length]=new Option(f.name,f.id)}void 0!=c&&(e.value=c);e.setFieldStatus=function(a){this.disabled=!a;this.previousSibling.className=a?"":"disabled"};return e};
Template.prototype.repopulateList=Template.repopulateList=function(a,b,c,d){this.post(b,c,function(b){var c,g=a.options;g.length=0;d&&(g[g.length]=new Option(d,""));if(b&&0<b.length)for(var h=0;h<b.length;h++)g[g.length]=new Option((c=b[h]).name,c.id)})};Template.prototype.genSubmit=function(a,b){var c=this.genInput(a,"submit");b&&(c.value=b);return c};
Template.prototype.genTextBox=Template.genTextBox=function(a,b,c,d){a=this.genInput(a,"text");b&&(a.maxLength=b);c&&(a.size=c);d&&(a.placeholder=d);a.setFieldStatus=function(a){this.disabled=!a;this.previousSibling.className=a?"":"disabled"};return a};
Template.prototype.genTextArea=function(a,b,c,d){var e;document.all?e=document.createElement('<textarea name="'+a+'" />'):(e=document.createElement("textarea"),e.name=a);b&&(e.cols=b);c&&(e.rows=c);void 0!=d&&(e.value=d);e.setFieldStatus=function(a){this.disabled=!a;this.previousSibling.className=a?"":"disabled"};return e};Template.prototype.encodeHTML=Template.encodeHTML=function(a){return a};
Template.prototype.escapeHTML=Template.escapeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};Template.prototype.getLocation=Template.getLocation=function(a){return $(a).offset()};Template.prototype.getLocationBelow=Template.getLocationBelow=function(a){var b=(a=$(a)).offset();b.top+=a.outerHeight();return b};
Template.prototype.getLocationRightBottom=Template.getLocationRightBottom=function(a){var b=(a=$(a)).offset();b.top+=a.outerHeight();b.right=b.left+a.outerWidth();return b};Template.prototype.getLocationRightTop=Template.getLocationRightTop=function(a){var b=(a=$(a)).offset();b.right=b.left+a.outerWidth();b.bottom=b.top+a.outerHeight();return b};function TabTemplate(){}function Tab(a,b,c,d,e){this.id=a;this.caption=b;this.children=c;this.right=d;this.onlyAction=e}TabTemplate.prototype=new Template;TabTemplate.prototype.CSS_MAIN="tabber";TabTemplate.prototype.CSS_TABS="tabs";
TabTemplate.prototype.init=function(a){var b=this,c={anchors:[]},d,e,f,g,h=document.createElement("div");h.className=this.CSS_MAIN;h.appendChild(e=this.createElement("div",void 0,this.CSS_TABS));for(var k=0;k<this.TABS.length;k++)d=void 0,g=this.TABS[k],g.id&&(e.appendChild(d=c.anchors[k]=this.createAnchor(g.caption,function(a){b.handleAction(c,this)})),c[g.id]=d),g.children&&(d||e.appendChild(d=c.anchors[k]=this.createAnchor(g.caption,function(a){this.myInit&&(b.showTab(c,this),b.closeMenuNow(c,
this))})),d.onmouseover=function(a){b.openMenu(c,this)},d.onmouseout=function(a){b.closeMenuSoon(c,this)}),d.myIndex=k,d.myInit=!1,d.myTab=g,h.appendChild(f=document.createElement("div")),(d.myBody=$(f)).hide();g=c.currentTab=this.TABS[0];d=c.currentAnchor=c.anchors[0];(f=d.myBody).show();d.myInit=!0;d.className="selected";this[g.id](f);a.empty();a.append(h);if(void 0!=this.onPostInit)this.onPostInit(c);return c};
TabTemplate.prototype.changeTab=function(a,b){var c=a.anchors;if(0>b||c.length<=b)throw"The INDEX is not valid.";c=c[b];this.handleAction(a,c);return c.myBody};TabTemplate.prototype.changeTabById=function(a,b){var c=a[b];if(!c)throw"The INDEX is not valid.";this.handleAction(a,c);return c.myBody};
TabTemplate.prototype.handleAction=function(a,b){var c=a.currentAnchor;c.myBody.hide();c.className="";var d=a.currentTab=b.myTab;a.currentAnchor=b;c.myIndex==b.myIndex&&(b.myInit=!1);b.className="selected";b.myBody.show();b.myInit||(b.myInit=!0,this[d.id](b.myBody))};TabTemplate.prototype.showTab=function(a,b){var c=a.currentAnchor;c.myBody.hide();c.className="";a.currentTab=b.myTab;a.currentAnchor=b;b.className="selected";b.myBody.show()};
TabTemplate.prototype.openMenu=function(a,b){b.mySubMenuCloseId&&(window.clearTimeout(b.mySubMenuCloseId),delete b.mySubMenuCloseId);if(!b.mySubMenu){var c=this,d=b.myTab,e,f=b.mySubMenu=document.createElement("div");f.className="tabberDropdown";(e=document.body).insertBefore(f,e.firstChild);for(var g,h=d.children,k=0;k<h.length;k++)g=h[k],f.appendChild(e=this.createAnchor(g.caption,function(d){if(this.myTab.onlyAction)c[this.myTab.id]();else c.showTab(a,b),c[this.myTab.id](b.myBody),b.myInit=!0;
c.closeMenuNow(a,b)})),e.onmouseover=function(a){b.mySubMenuCloseId&&(window.clearTimeout(b.mySubMenuCloseId),delete b.mySubMenuCloseId)},e.onmouseout=function(d){c.closeMenuSoon(a,b)},e.myTab=g;e=f.style;g=Template.getLocationBelow(b);e.top=g.top+"px";e.display="block";d.right&&(g.left-=f.clientWidth-b.clientWidth);e.left=g.left+"px"}};TabTemplate.prototype.closeMenuNow=function(a,b){document.body.removeChild(b.mySubMenu);delete b.mySubMenu};
TabTemplate.prototype.closeMenuSoon=function(a,b){b.mySubMenu&&(b.mySubMenuCloseId=window.setTimeout(function(){b.mySubMenu&&b.mySubMenuCloseId&&(document.body.removeChild(b.mySubMenu),delete b.mySubMenu,delete b.mySubMenuCloseId)},500))};function ListTemplate(a){this.load(a);if(this.CAN_EDIT||this.CAN_ADD||this.FIELDS)this.EDITOR=new EditTemplate(a);this.OPEN_CHILD=void 0!=this.openChild;this.HAS_ROW_ACTIONS=this.CAN_REMOVE||this.OPEN_CHILD||this.ROW_ACTIONS||this.HISTORY;this.IDENTIFIER||(this.IDENTIFIER="id");!this.DESC_COLS&&this.COLUMNS&&(a=this.COLUMNS.length,this.HAS_ROW_ACTIONS&&a++,a/=2,this.DESC_COLS=Math.ceil(a),this.NAV_COLS=Math.floor(a));this.SEARCH?(this.SEARCH_METHOD||(this.SEARCH_METHOD="post"),this.SEARCH_PATH||(this.SEARCH_PATH=
this.RESOURCE+"/search"),this.SEARCH_BIG||(this.SEARCH_BIG=this.RESOURCE+"/big"),this.search=new EditTemplate(this.SEARCH),this.search.handleSubmit=function(a,c){this.populate(a,c);if(this.onEditorPreSubmit)this.onEditorPreSubmit(a);a.isModal&&a.body.closeMe();a.callback(a.value)}):this.SEARCH_POST?(this.SEARCH_METHOD="post",this.SEARCH_PATH=this.RESOURCE+"/search"):(this.SEARCH_METHOD="get",this.SEARCH_PATH=this.RESOURCE);this.HISTORY&&(this.HISTORY_VIEWER=new HistoryTemplate(this.HISTORY),void 0==
this.ROW_ACTIONS&&(this.ROW_ACTIONS=[]),this.ROW_ACTIONS.push(new RowAction("openHistory","History")));this.exporter=new EditTemplate(this.EXPORT)}function TextColumn(a,b,c,d,e,f,g){this.id=a;this.caption=b;this.formatter=c?c:"toText";this.selectable=d;this.highlight=e;this.clickHandler=f;this.css=e?"highlight":g}function IdColumn(a,b,c,d,e,f){this.id=a;this.caption=b;this.formatter="toIdentifier";this.selectable=c;this.highlight=d;this.clickHandler=e;this.css=d?"highlight":f}
function EditColumn(a,b,c){this.id=a;this.caption=b;this.formatter=c?c:"toText";this.editable=!0}function RowAction(a,b,c,d){this.id=a;this.caption=b;this.condition=c;this.uncondition=d}ListTemplate.prototype=new Template;ListTemplate.prototype.MAX_PAGES=500;ListTemplate.prototype.HALF_MAX_PAGES=250;ListTemplate.prototype.EDIT_METHOD="post";ListTemplate.prototype.init=function(a){return this.filter({},a)};
ListTemplate.prototype.filter=function(a,b,c){return this.run({filter:a,baseFilter:a,url:this.SEARCH_PATH,exclusions:c},b,this.SEARCH_METHOD)};ListTemplate.prototype.filterX=function(a,b){return this.run({filter:a,baseFilter:a,url:this.SEARCH_PATH,extra:b},void 0,this.SEARCH_METHOD)};ListTemplate.prototype.getTitle=function(a){return a.parent?this.PARENT+" "+this.PLURAL+": "+a.parent.name:a.extra&&a.extra.name?this.PLURAL+": "+a.extra.name:this.PLURAL};
ListTemplate.prototype.onPostLoad=function(a){if(a.isModal){var b=$(window),c=a.body;if(c.height()>b.height()){for(var d=a.tbody,e=d.rows,f=e[0].cells,g=[],h=0;h<f.length;h++)f[h].style.width=(g[h]=f[h].clientWidth)+"px";for(h=1;h<e.length;h++)for(var f=e[h].cells,k=0;k<g.length;k++)f[k].style.width=g[k]+"px";h=c.height()-d.offsetHeight+25;d.style.height=b.height()-h+"px";d.className=this.CSS_MODAL;a.table.style.display="inline";b=a.thead.rows[1].cells;for(h=0;h<g.length;h++)b[h].style.width=g[h]+
"px"}}if(this.onListPostLoad)this.onListPostLoad(a)};ListTemplate.prototype.handleCancel=function(a){a.isModal&&a.body.closeMe()};ListTemplate.prototype.doPaging=function(a,b){var c=a.filter;c.page=b.nextPage;b.myPageToken&&(c.pageToken=b.myPageToken);this.run(a)};ListTemplate.prototype.doSort=function(a,b){var c=a.filter,d=a.value;c.sortOn=b.sortOn;d.sortOn==c.sortOn?c.sortDir="ASC"==d.sortDir?"DESC":"ASC":delete c.sortDir;this.run(a)};
ListTemplate.prototype.generate=function(a){var b=a.value;$.isArray(b)&&(a.value=b={total:b.length,pageSize:b.length,page:1,pages:1,records:b});b=b.records;if(!b||0==b.length)return this.createNoRecordsFoundMessage(a);b=a.table=document.createElement("table");this.appendHeader(a,b);this.appendBody(a,b);return b};
ListTemplate.prototype.createNoRecordsFoundMessage=function(a){var b=a.value,b=this.createDiv(b.message?b.message:"No "+this.PLURAL+" found.","noRecordsFound"),c=this;this.CAN_ADD&&b.appendChild(this.createAnchor("Click here to add a new "+this.SINGULAR+".",function(b){c.handleAdd(a,this)}));this.search&&b.appendChild(this.createAnchor("Click here to apply a different search.",function(b){c.handleSearch(a,this)}));return b};
ListTemplate.prototype.appendHeader=function(a,b){var c,d=a.thead=b.createTHead(),e,f=this.COLUMNS;this.insertPaging(b,d,a);c=this.insertRow(d);this.HAS_ROW_ACTIONS&&c.insertCell(0);for(var g=$.extend({},a.exclusions),h=0;h<f.length;h++)e=f[h],g[e.id]||this.insertHeader(c,e.id,e.caption,a);return d};
ListTemplate.prototype.appendBody=function(a,b){var c,d,e=this.COLUMNS,f,g=a.value.records,h,k,l,n=a.tbody=document.createElement("tbody");b.appendChild(n);for(var m=this,q=$.extend({},a.exclusions),p=0;p<g.length;p++){f=g[p];l=this.insertRow(n);this.HAS_ROW_ACTIONS&&(h=this.addDiv(this.insertCell(l),void 0,"rowActions"),this.CAN_REMOVE&&(h.appendChild(c=this.createAnchor("&chi;",function(b){m.removeRecord(a,this)},"delete")),c.myRecord=f),this.addSpace(h),this.OPEN_CHILD&&(h.appendChild(c=this.createAnchor("&crarr;",
function(b){m.openChild(a,this)},"drilldown")),c.myRecord=f,this.decorateOpenChildAnchor(c,f)),this.addSpace(h),this.ROW_ACTIONS&&(h.appendChild(c=this.createAnchor(void 0,function(a){return!1},"config")),c.myRecord=f,c.onmouseover=function(b){m.openActionsMenu(a,this)},c.onmouseout=function(b){m.closeActionsMenuSoon(a,this)}));for(var r=0;r<e.length;r++)d=e[r],q[d.id]||(c=this[d.formatter](k=f[d.id],f),h=void 0,d.selectable?h="handleSelect":d.clickHandler&&(h=d.clickHandler),h?(d=this.insertCell(l,
d.css,c=this.createAnchor(c,function(b){m[this.myOnSelect](a,this)})),c.myOnSelect=h,c.myRecord=f):this.CAN_EDIT&&void 0!=k&&"boolean"==typeof k?(d=this.insertCell(l,d.css,h=this.genCheckBox(d.id,k)),d.className+=" center",h.onclick=function(b){m.toggleProperty(a,this)},h.myRecord=f):d.editable?$(this.insertCell(l,d.css,c)).dblclick({c:a,r:f,f:d,t:c},function(a){if(!(1<a.which)){a.preventDefault();var b=a.data;a=a.target;var c=m.genTextBox(b.f.id),d=b.r[b.f.id];c.style.width=a.clientWidth-16+"px";
c.value=d?d:"";a.innerHTML="";a.appendChild(c);c.focus();b.cell=a;$(c).blur(b,function(a){a.target.cancelBlur||(a.data.cell.innerHTML=a.data.t)}).change(b,function(a){a.target.cancelBlur=!0;m.updateField(a.data,a.target)})}}):this.insertCell(l,d.css,c))}return n};ListTemplate.prototype.openHistory=function(a,b){this.HISTORY_VIEWER.open(b.myRecord[this.IDENTIFIER])};
ListTemplate.prototype.openActionsMenu=function(a,b){this.clearMenuClose(b);if(!b.myMenu){var c=this,d=b.myRecord,e,f,g=b.myMenu=document.createElement("div");g.className="tabberDropdown";(e=document.body).insertBefore(g,e.firstChild);for(var h=0;h<this.ROW_ACTIONS.length;h++)f=this.ROW_ACTIONS[h],f.condition&&!d[f.condition]||f.uncondition&&d[f.uncondition]||(g.appendChild(e=this.createAnchor(f.caption,function(d){c[this.myId](a,this);c.closeActionsMenu(a,b)})),e.myRecord=d,e.myId=f.id,e.onmouseover=
function(a){c.clearMenuClose(b)},e.onmouseout=function(d){c.closeActionsMenuSoon(a,b)});d=g.style;e=this.getLocationRightTop(b);d.display="block";f=$(window);d.maxHeight=f.height()+"px";f.height()/2<e.top-f.scrollTop()?(g=e.bottom-$(g).outerHeight(),g<f.scrollTop()&&(g=f.scrollTop()),d.top=g+"px"):(g=e.top+$(g).outerHeight(),g>f.height()+f.scrollTop()&&(e.top-=g-(f.height()+f.scrollTop())),d.top=e.top+"px");d.left=e.right+"px"}};
ListTemplate.prototype.clearMenuClose=function(a){a.myMenuCloseId&&(window.clearTimeout(a.myMenuCloseId),delete a.myMenuCloseId)};ListTemplate.prototype.closeActionsMenu=function(a,b){document.body.removeChild(b.myMenu);delete b.myMenu};ListTemplate.prototype.closeActionsMenuSoon=function(a,b){b.myMenu&&(b.myMenuCloseId=window.setTimeout(function(){b.myMenu&&b.myMenuCloseId&&(document.body.removeChild(b.myMenu),delete b.myMenu,delete b.myMenuCloseId)},500))};
ListTemplate.prototype.insertRow=function(a){a=a.insertRow(a.rows.length);a.className=0==a.rowIndex%2?"even":"odd";return a};ListTemplate.prototype.insertPaging=function(a,b,c){this.insertPaging_(b,c);this.insertPaging_(c.tfoot=a.createTFoot(),c)};
ListTemplate.prototype.insertPaging_=function(a,b){var c=this,d=b.value,e=this.insertRow(a),f=e.insertCell(0);f.colSpan=this.DESC_COLS;if(1==d.total)f.innerHTML="Showing only "+this.SINGULAR;else{var g=d.records.length;f.innerHTML=1==g?"Showing one "+this.SINGULAR:"Showing "+g+" "+this.PLURAL;f.innerHTML+=" out of "+d.total}this.CAN_ADD&&f.appendChild(this.createAnchor("Add Item",function(a){c.handleAdd(b,this)},"action"));this.search&&(f.appendChild(this.createAnchor("Search",function(a){c.handleSearch(b,
this)},"action")),b.hasSearchFilter&&f.appendChild(this.createAnchor("Searched",function(a){c.handleSearched(b,this)},"action")));f.appendChild(this.createAnchor("Refresh",function(a){c.handleRefresh(b,this)},"action"));f.appendChild(this.createAnchor("Export",function(a){c.generateCSV(b,this)},"action"));if(this.ACTIONS)for(g=0;g<this.ACTIONS.length;g++){var h,k=this.ACTIONS[g];f.appendChild(h=this.createAnchor(k.caption,function(a){c[this.myId](b,this)},"action"));h.myId=k.id}f=e.insertCell(1);
f.colSpan=this.NAV_COLS;f.className="right";if(!(2>d.pages)){1<d.page&&(f.appendChild(e=this.createAnchor("&lArr; prev",function(a){c.doPaging(b,this)})),e.nextPage=d.page-1,f.appendChild(document.createTextNode(" ")));g=1;h=d.pages;this.MAX_PAGES<d.pages&&(this.HALF_MAX_PAGES<d.page&&(g=d.page-this.HALF_MAX_PAGES),h=g+this.MAX_PAGES,h>d.pages&&(h=d.pages,g=h-this.MAX_PAGES));f.appendChild(e=document.createElement("select"));k=0;for(1<g&&(e.options[k++]=new Option(1,1,!1,1==d.page));g<=h;g++,k++)e.options[k]=
new Option(g,g,!1,g==d.page);d.pages>h&&(e.options[k++]=new Option(d.pages,d.pages,!1,d.pages==d.page));e.onchange=function(a){this.nextPage=this.value;c.doPaging(b,this)};d.pages>d.page&&(f.appendChild(document.createTextNode(" ")),f.appendChild(e=this.createAnchor("next &rArr;",function(a){c.doPaging(b,this)})),e.nextPage=d.page+1,d.filter.pageToken&&(e.myPageToken=d.filter.pageToken))}};
ListTemplate.prototype.insertHeader=function(a,b,c,d){var e=this;a=a.insertCell(a.cells.length);a.appendChild(c=this.createAnchor(c,function(a){e.doSort(d,this)}));c.sortOn=b;c=d.value;b==c.sortOn&&a.appendChild(this.createSpan(" "+("ASC"==c.sortDir?"&uarr;":"&darr;")));return a};ListTemplate.prototype.insertCell=function(a,b,c){var d=a.insertCell(a.cells.length);d.className=b?b:a.className;void 0!=c&&(a=typeof c,"string"==a||"number"==a?d.innerHTML=c:d.appendChild(c));return d};
ListTemplate.prototype.decorateOpenChildAnchor=function(a,b){if(void 0!=b.numberOfChildren)this.addSpan(a," ("+this.toWhole(b.numberOfChildren)+")");else{var c=this;this.COUNT_CHILDREN_URL&&Template.post(this.COUNT_CHILDREN_URL,{id:b.id},function(b){c.addSpan(a," ("+c.toWhole(b)+")")})}};ListTemplate.prototype.handleAdd=function(a,b){var c=this;this.EDITOR.doAdd(function(b){c.run(a,void 0,c.SEARCH_METHOD)},this.NO_EDITOR_MODAL?a.body:void 0,a.defaultValue,a.submitUrl)};
ListTemplate.prototype.handleCopy=function(a,b){var c=this.cloneObject(b.myRecord);delete c[this.IDENTIFIER];var d=this;this.EDITOR.doAdd(function(b){d.run(a,void 0,d.SEARCH_METHOD)},this.NO_EDITOR_MODAL?a.body:void 0,c,a.submitUrl)};ListTemplate.prototype.handleSelect=function(a,b){var c=this;this.EDITOR.doEdit(b.myRecord[this.IDENTIFIER],function(b){c.run(a,void 0,c.SEARCH_METHOD)},this.NO_EDITOR_MODAL?a.body:void 0,a.submitUrl)};
ListTemplate.prototype.handleSearch=function(a,b){var c=this;this.search.doSearch(function(b){b&&(a.filter=b);a.url=c.SEARCH_PATH;a.hasSearchFilter=!0;c.run(a,void 0,c.SEARCH_METHOD)},this.NO_SEARCH_MODAL?a.body:void 0,a.baseFilter)};ListTemplate.prototype.handleSearched=function(a,b){var c=this;this.search.doSearch(function(b){b&&(a.filter=b);a.url=c.SEARCH_PATH;a.hasSearchFilter=!0;c.run(a,void 0,c.SEARCH_METHOD)},this.NO_SEARCH_MODAL?a.body:void 0,a.value.filter)};
ListTemplate.prototype.handleBig=function(a,b){var c=this;this.search.doSearch(function(b){b&&(a.filter=b);a.url=c.SEARCH_BIG;a.hasSearchFilter=!0;c.run(a,void 0,c.SEARCH_METHOD)},this.NO_SEARCH_MODAL?a.body:void 0,a.baseFilter)};ListTemplate.prototype.handleRefresh=function(a,b){this.search?this.run(a,a.body,this.SEARCH_METHOD):this.init(a.body)};
ListTemplate.prototype.removeRecord=function(a,b){if(window.confirm("Click OK to confirm and continue with your delete.")){var c=this;this.remove(this.RESOURCE,b.myRecord[this.IDENTIFIER],function(b){b.isError?window.alert(b.message):c.run(a,void 0,c.SEARCH_METHOD)})}};
ListTemplate.prototype.updateField=function(a,b){var c=a.r;c[a.f.id]=b.value;this[this.EDIT_METHOD](this.RESOURCE,c,function(c){if(c.isError)c.message?window.alert(c.message):window.alert("An unexpected error occurred. Please contact the administrator."),b.focus(),b.cancelBlur=!1;else{var e=b.parentNode;e.innerHTML=a.t=b.value;var f=e.style.backgroundColor;e.style.backgroundColor="red";setTimeout(function(){e.style.backgroundColor=f},500)}})};
ListTemplate.prototype.toggleProperty=function(a,b){var c=b.myRecord;c[b.name]=b.checked;this[this.EDIT_METHOD](this.RESOURCE,c,function(a){if(a.isError)a.message?window.alert(a.message):window.alert("An unexpected error occurred. Please contact the administrator."),c[b.name]=b.checked=!b.checked;else{var e=b.parentNode,f=e.style.backgroundColor;e.style.backgroundColor="red";setTimeout(function(){e.style.backgroundColor=f},500)}})};
ListTemplate.prototype.generateCSV=function(a,b){for(var c=a.value.records,d="",e=this.EDITOR?this.EDITOR.FIELDS:this.COLUMNS,f=e.length,g=0;g<f;g++)0<g&&(d+=","),d+=e[g].caption;d+="\n";for(g=0;g<c.length;g++){var h=c[g];for(a=0;a<f;a++){0<a&&(d+=",");var k=h[e[a].id];if(void 0!=k)var l=typeof k,d="boolean"==l||"number"==l?d+k:d+('"'+k+'"')}d+="\n"}this.exporter.open(d)};
ListTemplate.prototype.EXPORT={NAME:"noCaption",getTitle:function(a){return"Generated Output"},open:function(a){this.run({value:{payload:a},filter:{isAdd:!0}})},FIELDS:[new EditField("payload","",!1,!0,100,30)],CAPTION_SUBMIT:void 0,CAPTION_CANCEL:Template.prototype.CAPTION_CLOSE};function EditTemplate(a){this.load(a)}function TextField(a,b,c,d,e){this.isText=!0;this.isEditable=!1;this.id=a;this.caption=b;this.footnote=d;this.includeOnAdds=e;c?"function"==typeof c?this.custom=c:this.formatter=c:this.formatter="toText"}function IdField(a,b,c,d){this.isText=!0;this.isEditable=!1;this.id=a;this.caption=b;this.footnote=c;this.includeOnAdds=d;this.formatter="toIdentifier"}
function LinkField(a,b,c,d){this.isLink=!0;this.isEditable=!1;this.id=a;this.caption=b;this.onClick=c;this.footnote=d}function BoolField(a,b,c,d){this.isEditable=this.isBoolean=!0;this.id=a;this.caption=b;this.isRequired=c;this.footnote=d}function BulkField(a,b,c,d){this.isEditable=this.isBulk=!0;this.id=a;this.caption=b;this.isRequired=c;this.footnote=d}function PermField(a,b,c,d){this.isEditable=!1;this.isPermissions=!0;this.id=a;this.caption=b;this.isRequired=c;this.footnote=d}
function EditField(a,b,c,d,e,f,g,h){this.isEditable=!0;this.id=a;this.caption=b;this.isRequired=c;this.isLong=d;this.maxLength=e;this.size=f;this.footnote=g;this.placeholder=h}function HideField(a){this.isHidden=!0;this.id=a}function JsonField(a,b,c,d,e,f){this.isEditable=this.isJSON=!0;this.id=a;this.caption=b;this.isRequired=c;this.isLong=!0;this.maxLength=d;this.size=e;this.footnote=f}
function MetaField(a,b,c,d,e,f){this.isEditable=this.isMeta=!0;this.id=a;this.caption=b;this.isRequired=c;this.doAdd=d;this.doEdit=e;this.footnote=f}function MultiField(a,b,c,d,e,f){this.isMulti=this.isEditable=!0;this.id=a;this.caption=b;this.isRequired=c;this.isLong=!0;this.maxLength=d;this.size=e;this.footnote=f}function RangeField(a,b,c,d,e,f){this.isEditable=this.isRange=!0;this.id=a;this.caption=b;this.isRequired=c;this.maxLength=d;this.size=e;this.footnote=f}
function ListField(a,b,c,d,e,f){this.isEditable=this.isSelectable=!0;this.id=a;this.caption=b;this.isRequired=c;this.options=d;this.footnote=e;this.header=f}function PickField(a,b,c,d,e,f){this.isEditable=this.isPickable=!0;this.id=a;this.caption=b;this.isRequired=c;this.options=d;this.columns=e;this.footnote=f}function RadioField(a,b,c,d,e,f){this.isEditable=this.isRadio=!0;this.id=a;this.caption=b;this.isRequired=c;this.options=d;this.columns=e;this.footnote=f}
function DateField(a,b,c,d){this.isEditable=this.isDate=!0;this.id=a;this.caption=b;this.isRequired=c;this.doSelect=d}function DatesField(a,b,c,d,e){this.isEditable=this.isDateRange=!0;this.id=a;this.caption=b;this.isRequired=c;this.doSelect=d;this.footnote=e}function TimeField(a,b,c,d){this.isEditable=this.isTime=!0;this.id=a;this.caption=b;this.isRequired=c;this.doSelect=d}
function StampField(a,b,c,d){this.isEditable=this.isTimestamp=!0;this.id=a;this.caption=b;this.isRequired=c;this.doSelect=d}
function DropField(a,b,c,d,e,f,g){this.isEditable=this.isDropdownList=!0;this.id=a;this.caption=b;this.isRequired=c;this.doFill="function"==typeof d?d:function(a){Template.get(d,{name:a.field.value},function(b){return a.caller.fill(a,b)},void 0,g)};this.doSelect="function"==typeof e?e:function(a){var b=a.selection;a.extra.texts[e].innerHTML=b?b.name+" ("+b.id+")":"Cleared"};this.footnote=f}
function TagField(a,b,c,d,e,f,g){this.isEditable=this.isWidget=this.isTagger=!0;this.widget=DropdownTagger;this.id=a;this.caption=b;this.isRequired=c;this.doFill="function"==typeof d?d:function(a){Template.get(d,{name:a.field.value},function(b){a.caller.fill(a,b)})};this.doPostSelect=e;this.footnote=f;this.addCallback=g}
function MediaTagField(a,b,c,d,e,f,g){this.isEditable=this.isWidget=this.isTagger=!0;this.widget=MediaDropdownTagger;this.id=a;this.caption=b;this.isRequired=c;this.doFill="function"==typeof d?d:function(a){Template.get(d,{name:a.field.value},function(b){a.caller.fill(a,b)})};this.doPostSelect=e;this.footnote=f;this.addCallback=g}function PassField(a,b,c,d,e){this.isEditable=this.isPassword=!0;this.id=a;this.caption=b;this.isRequired=c;this.maxLength=d;this.size=e}
function FileField(a,b,c){this.isEditable=this.isFile=!0;this.id=a;this.caption=b;this.isRequired=c}EditTemplate.prototype=new Template;EditTemplate.prototype.doAdd=function(a,b,c,d){this.run({value:void 0!=c?c:{active:!0},filter:{isAdd:!0},callback:a,submitUrl:d},b)};EditTemplate.prototype.doEdit=function(a,b,c,d){this.run({callback:b,url:this.RESOURCE+"/"+a,submitUrl:d},c,"get")};EditTemplate.prototype.doValue=function(a,b){this.run({value:a,filter:{isAdd:!1}},b)};
EditTemplate.prototype.doSearch=function(a,b,c){this.run({value:{},filter:$.extend({isSearch:!0,isAdd:!1,pageSize:20},c),callback:a},b)};EditTemplate.prototype.ADD_METHOD="post";EditTemplate.prototype.EDIT_METHOD="post";EditTemplate.prototype.getTitle=function(a){var b=a.filter;void 0==b&&(b={});b=b.isSearch?"Search "+this.PLURAL:(b.isAdd?"Add":"Edit")+" "+this.SINGULAR;if(a=this.getName(a))b+=": "+a;return b};
EditTemplate.prototype.getName=function(a){return(a=a.parent?a.parent:a.value)&&a.name?a.name:null};EditTemplate.prototype.onPostLoad=function(a){a.isModal&&this.setFieldsMaxHeight(a);a.firstField&&a.firstField.focus();if(this.onEditorPostLoad)this.onEditorPostLoad(a)};EditTemplate.prototype.handleCancel=function(a){a.isModal?a.body.closeMe():a.callback()};
EditTemplate.prototype.handleSubmit=function(a,b){this.populate(a,b);if(a.filter.isSearch)a.callback(a.value,a);else{if(this.onEditorPreSubmit)this.onEditorPreSubmit(a);var c=this;this[a.filter.isAdd?this.ADD_METHOD:this.EDIT_METHOD](a.submitUrl?a.submitUrl:this.RESOURCE,a.value,function(d){c.processResponse(d,a,b)})}};
EditTemplate.prototype.processError=function(a,b,c){var d;if((b=a.errors)&&0<b.length)for(var e=0;e<b.length&&void 0==(d=c.elements[b[e].name]);e++);window.alert(a.message);d&&d.focus();return!1};EditTemplate.prototype.processNormal=function(a,b,c){b.isModal&&b.body.closeMe();(c=b.callback)&&c(a,b);return!0};EditTemplate.prototype.processResponse=function(a,b,c){return a.isError?this.processError(a,b,c):this.processNormal(a,b,c)};
EditTemplate.prototype.populate=function(a,b){for(var c=a.value,d=0;d<this.FIELDS.length;d++){var e=this.FIELDS[d];if(e.isEditable||e.isHidden){var f=e.id;if(e.isRange||e.isDateRange)c[f+"From"]=b.elements[f+"From"].value,c[f+"To"]=b.elements[f+"To"].value;else{var g=b.elements[f];if(g)if(e.isPickable){for(var e=[],h=0;h<g.length;h++)g[h].checked&&(e[e.length]=g[h].value);0<e.length?c[f]=e:delete c[f]}else if(e.isRadio)for(var k,h=0;h<g.length;h++)c[(k=g[h]).value]=k.checked;else"checkbox"==g.type?
c[f]=g.checked:e.isMulti?c[f]=this.toArray(g.value):e.isJSON||e.isMeta?c[f]=this.fromJSON(g.value):e.isLong?c[f]=this.encodeHTML(g.value):e.isTagger?c[f]=e.widget.retrieve(a.texts[f]).selectedIds:e.isTime||e.isTimestamp?""!=g.value&&(c[f]=parseInt(g.value)):c[f]=g.value}}}this.clean(c)};
EditTemplate.prototype.generate=function(a){if(this.onEditorPreGenerate)this.onEditorPreGenerate(a);var b=this,c=a.isModal,d,e=a.form=this.createElement("form");d=a.filter;void 0==d&&(a.filter=d={});var f=d.isSearch?d:a.value,g,h,k,l=d.isAdd;e.className=this.NAME;e.onsubmit=function(c){try{b.handleSubmit(a,this)}catch(d){window.console&&console.log(d)}finally{return!1}};c||(a.header=this.addHeader(e,d.isSearch?"Search "+this.PLURAL:(l?"Add":"Edit")+" "+this.SINGULAR));for(var n=a.captions={},m=a.texts=
{},q=a.fields=this.addDiv(e,void 0,this.CSS_FIELDS),p=0;p<this.FIELDS.length;p++)h=this.FIELDS[p],l&&h.isText&&!h.includeOnAdds||(g=h.id,k=f[g],h.isHidden?e.appendChild(this.genHidden(g,k)):(d=this.addDiv(q),n[g]=c=this.addCaption(d,h.caption+(h.isRequired?"*":"")),h.footnote&&this.addFootnote(c,h.footnote),c=void 0,h.isText?m[g]=h.custom?this.addValue(d,h.custom(f,k,this)):this.addValue(d,this[h.formatter](k)):h.isLink?(g=this.createAnchor(k,h.onClick),g.myValue=f,d.appendChild(g)):h.isSelectable?
d.appendChild(c=this.genSelect(g,this.getList(h.options),k,h.header)):h.isDropdownList?d.appendChild(DropdownList.create(g,h,k,a)):h.isBoolean?d.appendChild(this.genCheckBox(g,k)):h.isDate?d.appendChild(DatePicker.create(g,k,a,h)):h.isTime?d.appendChild(TimePicker.create(g,k,a,h)):h.isTimestamp?d.appendChild(TimestampPicker.create(g,k,a,h)):h.isDateRange?(d.appendChild(this.createDatePicker(f,g+"From",a,h)),this.addText(d," to "),d.appendChild(this.createDatePicker(f,g+"To",a,h))):h.isBulk?(d.appendChild(c=
BulkAnswersEditor.create(g,k,a,h)),m[g]=c.myCriteria):h.isPermissions?d.appendChild(PermissionsViewer.create(g,k,a,h)):h.isMeta?d.appendChild(MetadataEditor.create(g,k,a,h)):h.isRange?(d.appendChild(c=this.genTextBox(g+"From",h.maxLength,h.size)),this.addText(d," to "),d.appendChild(this.genTextBox(g+"To",h.maxLength,h.size))):h.isPassword?d.appendChild(c=this.genPassword(g,h.maxLength,h.size)):h.isPickable?d.appendChild(this.genCheckBoxes(g,this.getList(h.options),k,h.columns)):h.isRadio?d.appendChild(this.genRadios(g,
this.getList(h.options),f,h.columns)):h.isTagger?(d.appendChild(c=h.widget.create(g,h,k,a)),m[g]=c=c.myCriteria,c=c.field):h.isFile?d.appendChild(c=this.genFile(g,128,50)):(h.isLong?d.appendChild(c=this.genTextArea(g,h.maxLength?h.maxLength:40,h.size?h.size:4)):d.appendChild(c=this.genTextBox(g,h.maxLength,h.size,h.placeholder)),h.isMulti?k=this.fromArray(k):h.isJSON&&(k=this.toJSON(k)),void 0!=k&&(c.value=k)),c&&!a.firstField&&(a.firstField=c)));d=a.actions=this.addDiv(e,void 0,this.CSS_ACTIONS);
void 0!=this.CAPTION_SUBMIT&&(d.appendChild(this.genSubmit("submitter",this.CAPTION_SUBMIT)),this.addSpace(d));void 0!=this.CAPTION_CANCEL&&d.appendChild(this.genButton("canceler",this.CAPTION_CANCEL,function(c){b.handleCancel(a)}));return e};EditTemplate.prototype.createDatePicker=function(a,b,c,d){return DatePicker.create(b,a[b],c,d)};function HistoryTemplate(a){this.load(a)}HistoryTemplate.prototype=new Template;HistoryTemplate.prototype.BASE_URI="auditLogs";HistoryTemplate.prototype.CSS_MAIN="history";HistoryTemplate.prototype.open=function(a,b){this.run({url:this.BASE_URI+"/"+this.RESOURCE+"/"+a},b,"get")};HistoryTemplate.prototype.getTitle=function(a){return this.SINGULAR+" Audit Log"};
HistoryTemplate.prototype.generate=function(a){var b=this,c,d=this.createDiv(void 0,this.CSS_MAIN),e=a.value;if(void 0==e||0==e.length)return this.createNoRecordsFoundMessage();for(var f=[],g=0;g<e.length;g++)f[g]={id:g,name:(c=e[g]).action+" at "+this.toDateTime(c.timestamp)+" by "+c.actorType+" / "+c.actionBy};d.appendChild(a.entries=c=this.genList("entries",20,f));c.selectedIndex=0;c.className=this.CSS_MAIN;c.onchange=function(c){b.handleChange(a,this)};(a.tree=$(this.addSpan(d,void 0,this.CSS_MAIN))).jsontree(JSON.parse(e[0].payload));
e=a.form=this.createElement("form",void 0,this.CSS_MAIN);c=a.fields=this.addDiv(e,void 0,this.CSS_MAIN);c.appendChild(d);c=a.actions=this.addDiv(e,void 0,this.CSS_ACTIONS);c.appendChild(this.genButton("canceler",this.CAPTION_CLOSE,function(c){b.handleCancel(a)}));this.addSpace(c);c.appendChild(this.genButton("copier",this.CAPTION_COPY,function(c){b.handleCopy(a,a.entries)}));return e};HistoryTemplate.prototype.handleCancel=function(a){a.isModal&&a.body.closeMe()};
HistoryTemplate.prototype.handleChange=function(a,b){a.tree.jsontree(JSON.parse(a.value[b.selectedIndex].payload))};HistoryTemplate.prototype.handleCopy=function(a,b){this.VIEWER.open(a.value[b.selectedIndex].payload)};HistoryTemplate.prototype.createNoRecordsFoundMessage=function(){return this.createDiv("No "+this.SINGULAR+" audit log entries found.","noRecordsFound")};
HistoryTemplate.prototype.VIEWER=new EditTemplate({NAME:"historyViewer",getTitle:function(a){return"Copy Viewer"},open:function(a){this.run({value:{data:a},filter:{}})},FIELDS:[new EditField("data","Payload",!1,!0,100,20)]});function JSONTemplate(a){this.load(a)}JSONTemplate.prototype=new Template;JSONTemplate.prototype.openParsed=function(a,b,c){this.run({url:this.RESOURCE+"/"+a+"/parsed",excludeFields:c},b,"get")};JSONTemplate.prototype.getTitle=function(a){return this.SINGULAR};JSONTemplate.prototype.onPostLoad=function(a){a.isModal&&this.setFieldsMaxHeight(a);if(this.onEditorPostLoad)this.onEditorPostLoad(a)};
JSONTemplate.prototype.generate=function(a){var b=a.value;if(void 0==b)return this.createNoRecordsFoundMessage();if(a.excludeFields)for(var c in a.excludeFields)delete b[c];c=this.createElement("form");$(a.fields=this.addDiv(c,void 0,this.CSS_FIELDS)).jsontree(b);return c};JSONTemplate.prototype.handleCancel=function(a){a.isModal&&a.body.closeMe()};JSONTemplate.prototype.createNoRecordsFoundMessage=function(){return this.createDiv("The "+this.SINGULAR+" was empty.","noRecordsFound")};function ViewTemplate(a){this.load(a)}ViewTemplate.prototype=new Template;ViewTemplate.prototype.getTitle=function(a){return this.SINGULAR};ViewTemplate.prototype.init=function(){this.run({value:{},filter:{isAdd:!1}})};ViewTemplate.prototype.open=function(a,b,c){void 0==c&&(c=this.GET_URL);this.run({filter:a,url:c},b,"get")};ViewTemplate.prototype.openById=function(a,b,c){this.open(b,c,this.GET_URL+a)};
ViewTemplate.prototype.onPostLoad=function(a){a.isModal&&(a.body.center(),a.header.style.width=a.form.offsetWidth+"px");if(this.onViewerPostLoad)this.onViewerPostLoad(a)};ViewTemplate.prototype.handleCancel=function(a){a.isModal&&a.body.closeMe()};ViewTemplate.prototype.generate=function(a){var b=this,c=a.form=this.createElement("form");c.className=this.NAME;this.append(a,c);this.addDiv(c,void 0,"close").appendChild(this.genButton("closer","Close",function(c){b.handleCancel(a)}));return c};
ViewTemplate.prototype.append=function(a,b){var c;c=this.addDiv(b);c.appendChild(this.createImg("images/ashley.png","Ashley&nbsp;da'Branch"));this.addElem(c,"h3","Ashley&nbsp;da'Branch","center")};var ProgressBar={INTERVAL:2E3,ITERATIONS:20,CAPTION:"Loading ...",start:function(a){var b=this,c=a.progressBarBody=$("<blockquote>");a.body.empty();a.body.append(c);c.html(a.progressBarLastCaption=this.CAPTION);a.progressBarInterval=1;a.progressBarIntervalId=window.setInterval(function(){b.ITERATIONS<a.progressBarInterval++?b.stop(a):c.html(a.progressBarLastCaption+=".")},this.INTERVAL)},stop:function(a){a.progressBarIntervalId&&(window.clearInterval(a.progressBarIntervalId),a.progressBarIntervalId=
void 0)}};var KEY_NULL=0,KEY_BACKSPACE=8,KEY_TAB=9,KEY_ENTER=13,KEY_ESCAPE=27,KEY_SPACE=32,KEY_PAGE_UP=33,KEY_PAGE_DOWN=34,KEY_END=35,KEY_HOME=36,KEY_LEFT=37,KEY_UP=38,KEY_RIGHT=39,KEY_DOWN=40,KEY_PAREN_OPEN=40,KEY_PAREN_CLOSED=41,KEY_PLUS=43,KEY_HYPHEN=45,KEY_ZERO=48,KEY_NINE=57,KEY_COLON=58;var DropdownList={CSS_MAIN:"dropdownList",CSS_HOVER:"hover",DELAY:500,SUFFIX:"_ddl",create:function(a,b,c,d){var e=this,f=document.createElement("span"),g=f.myCriteria={name:a,callback:b,value:c,closed:!0,caller:this,extra:d};f.appendChild(g.hidden=this.genInput(a,"hidden"));void 0!=c&&(g.hidden.value=c);f.appendChild(a=g.field=this.genInput(a+this.SUFFIX,"text"));f.appendChild(this.createAnchor("X",function(a){e.reset(g)},this.CSS_MAIN));f.appendChild(b=g.div=document.createElement("div"));f.className=
a.className=b.className=this.CSS_MAIN;a.setAttribute("autocomplete","off");$(a).keyup(g,function(a){var b=a.data;b.lastTimeoutId&&(window.clearTimeout(b.lastTimeoutId),delete b.lastTimeoutId);var c=a.which;""==a.target.value||KEY_ESCAPE==c||KEY_TAB==c?e.close(b):KEY_DOWN==c?e.moveDown(b,1):KEY_UP==c?e.moveUp(b,1):KEY_PAGE_DOWN==c?e.moveDown(b,10):KEY_PAGE_UP==c?e.moveUp(b,10):KEY_HOME==c?e.moveTo(b,0):KEY_END==c?e.moveTo(b,b.lastIndex):KEY_ENTER!=c&&(b.lastTimeoutId=window.setTimeout(function(){delete b.lastTimeoutId;
b.callback.doFill(b)},e.DELAY))}).keydown(g,function(a){var b=a.data;KEY_ENTER!=a.which||b.closed||(e.select(b),a.preventDefault())});return f},fill:function(a,b){var c=this,d,e=a.div;e.innerHTML="";a.anchors=[];for(var f=0;f<b.length;f++){var g=b[f];e.appendChild(d=a.anchors[f]=document.createElement("a"));d.href="javascript:void(null)";d.innerHTML=this.toCaption(g);d.myIndex=f;d.myItem=g;d.onclick=function(b){c.handleSelect(a,this)}}this.open(a);e.scrollTop=0;a.lastIndex=b.length-1;0<b.length?a.anchors[a.index=
0].className=this.CSS_HOVER:a.index=void 0},handleSelect:function(a,b){var c=a.selection=b.myItem;a.index=b.myIndex;a.hidden.value=c.id;a.field.value=c.name;this.close(a);c=a.callback;c.doSelect&&c.doSelect(a)},reset:function(a){delete a.selection;a.hidden.value="";a.field.value="";var b=a.callback;b.doSelect&&b.doSelect(a)},open:function(a){a.closed&&(a.closed=!1,a.div.style.display="block")},close:function(a){a.closed||(a.closed=!0,a.div.style.display="none")},select:function(a){void 0!=a.index&&
this.handleSelect(a,a.anchors[a.index])},moveUp:function(a,b){if(void 0!=a.index){var c=a.index-b;0>c&&(c=0);this.moveTo(a,c)}},moveDown:function(a,b){if(void 0!=a.index){var c=a.index+b;a.lastIndex<c&&(c=a.lastIndex);this.moveTo(a,c)}},moveTo:function(a,b){if(void 0!=a.index){a.anchors[a.index].className="";var c,d=a.div;(c=a.anchors[a.index=b]).className=this.CSS_HOVER;if(c.offsetTop<d.scrollTop||c.offsetTop+c.offsetHeight>d.scrollTop+d.clientHeight)d.scrollTop=c.offsetTop;this.open(a)}},clear:function(a,
b){var c;if(c=a.elements[b])c.value="";if(c=a.elements[b+this.SUFFIX])c.value=""},enable:function(a,b){var c;(c=a.elements[b])&&c.setFieldStatus(!0);if(c=a.elements[b+this.SUFFIX])c.disabled=!1},disable:function(a,b){var c;if(c=a.elements[b])c.value="",c.setFieldStatus(!1);if(c=a.elements[b+this.SUFFIX])c.value="",c.disabled=!0},focus:function(a,b){var c;(c=a.elements[b+this.SUFFIX])&&c.focus()}};DropdownList.genInput=Template.prototype.genInput;DropdownList.createAnchor=Template.prototype.createAnchor;
DropdownList.toCaption=function(a){return a.name+" ("+a.id+")"};var DatePicker={CSS_MAIN:"datePicker",SUFFIX:"_date",DAYS:"Su M Tu W Th F Sa".split(" "),MONTHS:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),create:function(a,b,c,d){void 0!=b&&(b=b.replace("+0000","Z"));var e,f=document.createElement("span"),g={name:a,value:b,closed:!0,caller:this,extra:c,callback:d};f.appendChild(e=g.hidden=this.genInput(a,"hidden"));f.appendChild(a=g.field=this.genInput(a+this.SUFFIX,"text"));f.appendChild(c=g.div=document.createElement("div"));f.className=a.className=
c.className=this.CSS_MAIN;a.setAttribute("autocomplete","off");void 0!=b&&(e.value=b,a.value=this.toInputDate(b));var h=this;a.onchange=function(a){if(""==this.value)return e.value="",g.value=void 0,!0;try{h.select(g,h.parseInputDate(this.value))}catch(b){return window.alert(b),!1}return!0};a.onfocus=function(a){h.open(g)};a.onblur=function(a){h.scheduleClose(g)};return f},open:function(a,b){this.cancelClose(a);var c=this,d,e,f=a.div;b||(b=void 0!=a.value?this.parseDbDate(a.value):new Date);var g,
h=1,k=b.getUTCMonth();b.setUTCDate(h);b.clone=function(){return new Date(this.getTime())};f.innerHTML="";f.appendChild(e=document.createElement("ul"));e.className="header";this.addFlippers(e,this.MONTHS[k],a,b,"Month");this.addFlippers(e,b.getUTCFullYear(),a,b,"FullYear");f.appendChild(e=document.createElement("ul"));e.className="caption";for(g=0;g<this.DAYS.length;g++)e.appendChild(d=document.createElement("li")),d.innerHTML=this.DAYS[g];f.appendChild(e=document.createElement("ul"));e.className=
"detail";e.appendChild(d=document.createElement("li"));d.className="buffer"+b.getDay();d.innerHTML="&nbsp;";e.appendChild(d=document.createElement("li"));this.addAnchor(d,h,function(b){c.select(a,this.myValue);return!1},b.clone());b.setUTCDate(++h);do g=b.getDay(),0==g&&(f.appendChild(e=document.createElement("ul")),e.className="detail"),e.appendChild(d=document.createElement("li")),this.addAnchor(d,h,function(b){c.select(a,this.myValue);return!1},b.clone()),b.setUTCDate(++h);while(k==b.getUTCMonth());
e.appendChild(d=document.createElement("li"));d.className="buffer"+(6-g);d.innerHTML="&nbsp;";f.appendChild(e=document.createElement("ul"));e.className="footer";e.appendChild(d=document.createElement("li"));this.addAnchor(d,"Close",function(b){c.close(a);return!1});a.closed=!1;f.style.display="block"},select:function(a,b){a.hidden.value=a.value=Template.toDbDate(b);a.field.value=this.toInputDate_(b);var c=a.callback;c&&c.doSelect&&c.doSelect(a,b);this.close(a)},close:function(a){delete a.scheduleCloseId;
a.closed=!0;a.div.style.display="none"},scheduleClose:function(a){if(!a.scheduleCloseId){var b=this;a.scheduleCloseId=setTimeout(function(){b.close(a)},1E3)}},cancelClose:function(a){a.scheduleCloseId&&(clearTimeout(a.scheduleCloseId),delete a.scheduleCloseId)}};DatePicker.genInput=Template.prototype.genInput;DatePicker.createAnchor=Template.prototype.createAnchor;DatePicker.addAnchor=function(a,b,c,d){b=this.createAnchor(b,c);b.myValue=d;a.appendChild(b);return b};
DatePicker.addFlipper=function(a,b,c,d,e,f){var g=this;this.addAnchor(a,b,function(a){a=this.myValue;a["set"+e](a["get"+e]()+f);g.open(c,a);return!1},d.clone())};DatePicker.addFlippers=function(a,b,c,d,e){var f=document.createElement("li");a.appendChild(f);this.addFlipper(f,"&lt;",c,d,e,-1);f.appendChild(document.createTextNode(b));this.addFlipper(f,"&gt;",c,d,e,1)};DatePicker.toInputDate=function(a){return this.toInputDate_(this.parseDbDate(a))};
DatePicker.toInputDate_=function(a){return a.getUTCMonth()+1+"/"+a.getUTCDate()+"/"+a.getUTCFullYear()};
DatePicker.parseInputDate=function(a){var b,c;a=a.split("/",3);if(2>a.length)throw"Invalid input date: must contain at least 2 parts separated by a backslash.";if(isNaN(b=parseInt(a[0])))throw"Invalid input date: the month ("+a[0]+") is not a number";if(1>b||12<b)throw"Invalid input date: the month ("+a[0]+") is not between 1 and 12.";if(isNaN(c=parseInt(a[1])))throw"Invalid input date: the date ("+a[1]+") is not a number";if(1>c||31<c)throw"Invalid input date: the date ("+a[1]+") is not between 1 and 31.";
var d=new Date;d.setUTCHours(0,0,0,0);d.setUTCMonth(b-1,c);if(2<a.length){if(isNaN(b=parseInt(a[2])))throw"Invalid input date: the year ("+a[2]+") is not a number";if(0>b)throw"Invalid input date: the year ("+a[2]+") has to be a positive number.";50>b?b+=2E3:100>b&&(b+=1900);d.setUTCFullYear(b)}return d};DatePicker.parseDbDate=function(a){a=new Date(a);a.setUTCHours(0,0,0,0);return a};
DatePicker.removeZeroPadding=function(a){if(""==a)return a;for(var b=0;b<a.length&&"0"==a.charAt(b);b++);0<b&&a.length>b&&(a=a.substr(b));return a};var LoginHandler=new EditTemplate({NAME:"login",SINGULAR:"Login",PLURAL:"Login",RESOURCE:"admins/self",getTitle:function(a){return this.SINGULAR},FIELDS:[new EditField("userName","User Name",!0,!1,50,30),new PassField("password","Password",!0,50,30),new BoolField("rememberMe","Remember Me?",!1)],doLogin:function(a,b){var c=this;this.run({filter:{isAdd:!0},value:{value:{}},callback:function(b){c.setCurrentSessionId(b.id,b.userName,b.rememberMe);c.anchorUp();a&&a()},submitUrl:"admins/auth"},b)},doLogout:function(){var a=
this;this.remove(this.RESOURCE,void 0,function(b){a.deleteCurrentSessionId();a.anchorUp()})},doStart:function(){this.ANCHOR=document.getElementById("loginLink");this.LOGIN_INFO=document.getElementById("loginInfo");this.anchorUp()},anchorUp:function(){var a=this;this.auth(this.RESOURCE,{},function(b){var c=a.ANCHOR,d=a.LOGIN_INFO;null==b?(d.innerHTML="",d.onclick=d.myRecord=void 0,c.innerHTML="Login",c.onclick=function(b){a.doLogin();return!1}):(d.innerHTML=b.id,d.myRecord=b,d.onclick=function(b){a.CHANGE_PASSWORD.doValue(this.myRecord)},
c.innerHTML="Logout",c.onclick=function(b){a.doLogout();return!1})})},CHANGE_PASSWORD:new EditTemplate({NAME:"admin",SINGULAR:"Change Password",PLURAL:"Change Password",RESOURCE:"admins/self",EDIT_METHOD:"put",FIELDS:[new TextField("id","ID"),new PassField("currentPassword","Current Password",!0,40,40),new PassField("newPassword","New Password",!0,40,40),new PassField("confirmPassword","Confirm Password",!0,40,40)]})});var MetadataEditor={CSS_MAIN:"metadata",create:function(a,b,c,d){var e,f=document.createElement("span");f.className=this.CSS_MAIN;f.appendChild(e=Template.genHidden(a,Template.toJSON(b)));var g={name:a,value:b,field:e,elem:f,extra:c,callback:d};c=0;if(b)for(var h in b)f.appendChild(this.genRow(++c,h,b[h],g));g.count=c;b=g.addSection=Template.addDiv(f);b.appendChild(Template.genTextBox(a+"_key_add",255,25));b.appendChild(Template.genTextBox(a+"_value_add",255,25));b.appendChild(e=Template.genButton(a+
"_add","+"));e.className=this.CSS_MAIN;e.onclick=function(a){MetadataEditor.onAdd(g,this)};return f},genRow:function(a,b,c,d){var e,f=d.name,g=document.createElement("div");g.appendChild(e=Template.genTextBox(f+"_key_"+a,255,25));e.value=b;e.onchange=function(a){MetadataEditor.onChange(d,this)};g.appendChild(e=Template.genTextBox(f+"_value_"+a,255,25));e.value=c;e.onchange=function(a){MetadataEditor.onChange(d,this)};g.appendChild(e=Template.genButton(f+"_remove","-"));e.className=this.CSS_MAIN;e.onclick=
function(b){MetadataEditor.onRemove(d,this,g,a)};return g},onAdd:function(a,b){var c,d;d=b.form;var e=a.name,f=(c=d.elements[e+"_key_add"]).value;""==f?(window.alert("Please supply the key."),c.focus()):(e=(d=d.elements[e+"_value_add"]).value,""==e?(window.alert("Please supply the value."),d.focus()):(a.elem.insertBefore(this.genRow(a.count+=1,f,e,a),a.addSection),this.onChange(a,b),c.value="",d.value="",c.focus()))},onChange:function(a,b){this.onChange_(a,b.form)},onChange_:function(a,b){for(var c,
d={},e=a.name,f=1;f<=a.count;f++)if(null!=(c=b.elements[e+"_key_"+f])){c=c.value;var g=b.elements[e+"_value_"+f].value;""!=c&&""!=g&&(d[c]=g)}a.value=d;a.field.value=Template.toJSON(d)},onRemove:function(a,b,c,d){b=b.form;c.parentNode.removeChild(c);this.onChange_(a,b)}};var PermissionsViewer={CSS_MAIN:"bulkAnswers",COLUMNS:["ID","Post?","Get?","Put?","Del?"],create:function(a,b,c,d){a=document.createElement("span");a.className=this.CSS_MAIN;if(!b||0==b.length)return a.innerHTML="No permissions to view.",a;c=this.appendHeader(document.createElement("table"));c.className=this.CSS_MAIN;d=document.createElement("tbody");var e=0,f;for(f in b){var g=b[f],h=d.insertRow(e++);h.insertCell(0).innerHTML=f;h.insertCell(1).innerHTML=Template.toText(g.post);h.insertCell(2).innerHTML=
Template.toText(g.get);h.insertCell(3).innerHTML=Template.toText(g.put);h.insertCell(4).innerHTML=Template.toText(g["delete"])}c.appendChild(d);a.appendChild(c);return a},appendHeader:function(a){var b=a.createTHead().insertRow(0),c;for(c in this.COLUMNS)b.insertCell(c).innerHTML=this.COLUMNS[c];return a}};var DropdownTagger=$.extend(!0,{},DropdownList);DropdownTagger.CSS_MAIN+=" tagger";DropdownTagger.create_=DropdownTagger.create;
DropdownTagger.create=function(a,b,c,d){a=this.create_(a,b,void 0,d);d=a.myCriteria;d.value={selectedIds:[],selectedNames:[],removedIds:[],removedNames:[]};d.list=Template.addElem(a,"ul",void 0,this.CSS_MAIN);c&&this.populate(d,c);var e=this;b.doSelect=function(a){e.addItem(a,a.selection);a.field.value="";a.field.focus();var b=a.callback;b.doPostSelect&&b.doPostSelect(a)};return a};DropdownTagger.retrieve=function(a){return a.value};
DropdownTagger.populate=function(a,b){for(var c=0;c<b.length;c++)this.addItem(a,b[c])};
DropdownTagger.addItem=function(a,b){var c=a.value,d,e=c.selectedIds;-1<e.indexOf(b.id)||(Template.addElem(a.list,"li",this.toCaption(b)).appendChild(d=Template.createAnchor("x",function(a){a=this.myRecord;var b=a.id,d=e.indexOf(b);-1<d&&(e.splice(d,1),c.selectedNames.splice(d,1),-1==c.removedIds.indexOf(b)&&(c.removedIds.push(b),c.removedNames.push(a.name)),$(this.parentNode).remove())})),d.myRecord=b,e.push(b.id),c.selectedNames.push(b.name))};
DropdownTagger.reset=function(a){a.value={selectedIds:[],selectedNames:[],removedIds:[],removedNames:[]};a.list.innerHTML=""};var MediaDropdownTagger=$.extend(!0,{},DropdownTagger);MediaDropdownTagger.toCaption_super=MediaDropdownTagger.toCaption;MediaDropdownTagger.toCaption=function(a){return'<img src="'+thumbsPath+a.name+'" width="16" height="16" />&nbsp;'+a.name+" ("+a.id+")"};var TimePicker={CSS_MAIN:"timePicker",SUFFIX:"_time",DEFAULT_INTERVAL:15,MINUTES_IN_DAY:1440,VALUES:{},create:function(a,b,c,d,e){e||(e=this.DEFAULT_INTERVAL);void 0==b&&(b=0);var f=document.createElement("span"),g={name:a,value:b,caller:this,extra:c,callback:d,interval:e};f.appendChild(c=g.hidden=Template.genInput(a,"hidden"));f.appendChild(a=g.field=Template.genSelect(a+this.SUFFIX,this.getValues(e),this.toMinutes(b)));f.className=a.className=this.CSS_MAIN;void 0!=b&&(c.value=(new Date(b)).getTime());
a.onchange=function(a){g.hidden.value=g.value=6E4*parseInt(this.value);d&&d.doSelect&&d.doSelect(g)};return f},toMinutes:function(a){a=new Date(a);return 60*a.getHours()+a.getMinutes()},getValues:function(a){var b=this.VALUES[a];if(b)return b;var c=0,d=0,b=[];do b[c++]={id:d,name:this.toCaption(d)};while((d+=a)<this.MINUTES_IN_DAY);return this.VALUES[a]=b},toCaption:function(a){var b=Math.floor(a/60);a%=60;var c=12>b?"AM":"PM";0==b?b=12:12<b&&(b-=12);10>a&&(a="0"+a);return b+":"+a+" "+c}};var TimestampPicker={CSS_MAIN:"timestampPicker",create:function(a,b,c,d,e){var f=document.createElement("span"),g={name:a,value:b,caller:this,extra:c,callback:d};f.appendChild(a=g.hidden=Template.genInput(a,"hidden"));f.className=this.CSS_MAIN;void 0!=b&&(a.value=(new Date(b)).getTime());g.dateCallback={doSelect:function(a,b){var c;void 0==g.value?c=new Date(b.getFullYear(),b.getMonth(),b.getDate()):(c=new Date(g.value),c.setFullYear(b.getFullYear(),b.getMonth(),b.getDate()));g.hidden.value=g.value=
c.getTime();d&&d.doSelect&&d.doSelect(g)}};g.timeCallback={doSelect:function(a){var b=new Date(a.value);a=void 0==g.value?new Date:new Date(g.value);a.setHours(b.getUTCHours(),b.getUTCMinutes(),0,0);g.hidden.value=g.value=a.getTime();d&&d.doSelect&&d.doSelect(g)}};f.appendChild(DatePicker.create((new Date).getTime(),b,c,g.dateCallback));f.appendChild(document.createTextNode(" "));f.appendChild(TimePicker.create((new Date).getTime(),b,c,g.timeCallback,e));return f}};
